import re
import time
from collect_data.fun.head import *
__url__ = "https://www.malwaredomainlist.com/hostslist/hosts.txt"
__check__ = "malwaredomainlist"
__info__ = "malware"
__reference__ = "malwaredomainlist.com"

def fetch():
    retval = {}
    content = getcontent(__url__)
    timestr = time.strftime('%a, %d %b %y',time.localtime(time.time()))
    if __check__ in content:
        if timestr in content:
            for line in content.split('\n'):
                line = line.strip()
                if not line or line.startswith('#') or '.' not in line:
                    continue
                match = re.search(r"\A127.0.0.1\s+(.+)\Z", line)
                if match:
                    if "www." in match.group(1):
                        string = match.group(1)[4:]
                        retval[string] = (__info__, __reference__)
                    else:
                        retval[match.group(1)] = (__info__, __reference__)

    return retval
if __name__ == '__main__':
    print(fetch())
